<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡πâ‡∏≤‡∏ô</title>
  <link rel="icon" href="favicon.ico" />
  
  <link rel="stylesheet" href="style.css">

  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <script defer src="./lib/supabase.min.js"></script>

  <script>
    (function(){
      function loadScript(u){return new Promise((res,rej)=>{const s=document.createElement('script');s.src=u;s.defer=true;s.onload=()=>res();s.onerror=rej;document.head.appendChild(s);});}
      async function ensureSupabase(){ if (window.supabase) return true;
        const urls=['./lib/supabase.min.js','/lib/supabase.min.js','supabase.min.js'];
        for (const u of urls){ try{ await loadScript(u); if (window.supabase) return true; }catch(_){ } }
        return !!window.supabase;
      }
      window.addEventListener('DOMContentLoaded', async ()=>{
        const btn=document.getElementById('loginBtn');
        if (btn) { btn.disabled=true; btn.textContent='‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏∞‡∏ö‡∏ö...'; }
        const ok=await ensureSupabase();
        if (btn) { btn.disabled=!ok; btn.textContent= ok? '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö':'‡πÑ‡∏°‡πà‡∏û‡∏ö Supabase'; }
      });
    })();
  </script>
</head>
<body>
  <div class="container">
    <header class="header">
    </header>



    <main id="mainContent" style="display:none">
      <div class="main-columns">
        <div id="left-column">
          <section class="card">
            <h2 class="card-header active" id="data-card-header">üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏Å‡∏π‡πâ</h2>
            <div class="card-content">
              <div class="input-group inline-group"><label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô</label><input id="housePrice" type="text" inputmode="numeric" value="1,890,000" oninput="formatNumberInput(this)">‡∏ö‡∏≤‡∏ó</div>
              <div class="input-group inline-group"><label>‡∏≠‡∏≤‡∏¢‡∏∏‡∏ú‡∏π‡πâ‡∏Å‡∏π‡πâ</label><input id="borrowerAge" type="number" value="30">‡∏õ‡∏µ</div>
              <div class="input-group inline-group"><label>‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label><input id="borrowerSalary" type="text" inputmode="numeric" value="15,000" oninput="formatNumberInput(this)">‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
              <div class="input-group inline-group"><label>‡πÇ‡∏ö‡∏ô‡∏±‡∏™</label><input id="borrowerBonus" type="text" inputmode="numeric" value="0" oninput="formatNumberInput(this)">‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ</div>
			
			<div class="input-group inline-group">
                <label>OT / ‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</label>
                <div class="multi-input-line">
                  <input id="borrowerOT" type="text" inputmode="numeric" value="0" oninput="formatNumberInput(this)">
                  <span>‡∏ö‡∏≤‡∏ó/</span>
                  <input id="borrowerOTMonths" type="number" value="1">
                  <span>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
                </div>
              </div>
			  
              <div class="input-group inline-group">
                <label>‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô</label>
                <div class="multi-input-line">
                  <input id="borrowerCommission" type="text" inputmode="numeric" value="0" oninput="formatNumberInput(this)">
                  <span>‡∏ö‡∏≤‡∏ó/</span>
                  <input id="borrowerCommissionMonths" type="number" value="1">
                  <span>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
                </div>
              </div>
			  
              <div class="input-group inline-group">
                <label>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label>
                <div class="multi-input-line">
                  <input id="borrowerOtherIncome" type="text" inputmode="numeric" value="0" oninput="formatNumberInput(this)">
                  <span>‡∏ö‡∏≤‡∏ó/</span>
                  <input id="borrowerOtherIncomeMonths" type="number" value="1">
                  <span>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
                </div>
              </div>
			  
              <div class="input-group inline-group"><label>‡∏´‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏ö‡∏π‡πÇ‡∏£</label><input id="borrowerDebt" type="text" inputmode="numeric" value="0" oninput="formatNumberInput(this)">‡∏ö‡∏≤‡∏ó/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
              <button class="btn" style="width:100%" onclick="calculateLoan()">üîç ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠</button>
            </div>
          </section>
        </div>

<div id="right-column">

    <section class="card blur">
      <div id="loginArea">
        <form id="loginForm" class="login-grid" onsubmit="event.preventDefault(); login();" autocomplete="on">
          <div class="input-group">
            <label style="color:#fff">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
            <input id="email" name="email" type="email" placeholder="admin@yourbank.com" required autocomplete="username email" autocapitalize="none" spellcheck="false" inputmode="email">
          </div>
          <div class="input-group">
            <label style="color:#fff">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
            <input id="password" name="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required autocomplete="current-password">
          </div>
          <button class="btn" id="loginBtn" type="submit" disabled>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        </form>
        <div id="libStatus" style="margin-top:8px;background:#fff3cd;color:#8a6d3b;border:1px solid #ffeaa7;padding:8px 10px;border-radius:8px;font-size:12px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ Supabase...</div>
        <div id="loginError" style="display:none;margin-top:8px;background:#ff6b6b99;padding:8px 10px;border-radius:8px;font-size:12px;">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</div>
        <div style="margin-top:6px;font-size:11px;opacity:.9">* ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‚Äî ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ô Supabase ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</div>
      </div>

		<div id="userArea" class="welcome" style="display:none">
				<div>
				  <div style="font-weight:700">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö <span id="who"></span></div>
				  <div id="roleBadge" style="font-size:11px;opacity:.9"></div>
				</div>
				<div class="welcome-buttons">
				  <div id="adminButtons" style="display:none; gap: 8px;">
					  <button class="btn" onclick="openBankAdminModal()">üè¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</button>
					  <button class="btn" onclick="openPromoAdminModal()">üõ†Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡∏ô</button>
				  </div>
				  <button class="btn btn-secondary" onclick="refreshPromos()">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÇ‡∏õ‡∏£</button>
				  <button class="btn btn-danger" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
				</div>
		</div>
    </section>

          <section class="card" id="actionButtonsCard">
            <h2 class="card-header active" style="cursor: default;">üöÄ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</h2>
            <div class="card-content action-buttons-grid">
              <button class="btn" onclick="showResultPanel('analysis')">üèÜ ‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)</button>
              <button class="btn btn-secondary" onclick="showResultPanel('comparison')">üè¶ ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡∏∏‡∏Å‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡∏ô</button>
              <button class="btn btn-secondary" onclick="showResultPanel('amortization')">üìã ‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞</button>
            </div>
          </section>

          <section class="card" id="analysisResultCard" style="display: none;">
            <div class="card-header-flex">
              <h2 class="card-header-title">üèÜ ‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)</h2>
              <button class="btn btn-danger btn-admin" onclick="showActionButtons()"> &lt; ‡∏Å‡∏•‡∏±‡∏ö </button>
            </div>
            <div class="card-content">
                <div class="results-grid" style="margin-bottom: 15px;">
                    <div class="result-item"><div>‡∏¢‡∏≠‡∏î‡∏Å‡∏π‡πâ‡∏¢‡∏∑‡∏°</div><div id="loanAmount" class="value">-</div></div>
                    <div class="result-item"><div>‡∏ú‡πà‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div><div id="monthlyPayment" class="value">-</div></div>
                </div>
                <div id="bestOfferDetails" style="background:#f8f9fa;border:1px solid #e9ecef;border-radius:8px;padding:10px">
                    <p><strong>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£:</strong> <span id="bestBank"></span></p>
                    <p><strong>‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô:</strong> <span id="bestPromo"></span></p>
                    <p><strong>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏π‡πâ:</strong> <span id="bestTerm"></span> ‡∏õ‡∏µ</p>
                    <p><strong>DSR:</strong> <span id="bestDSR"></span>%</p>
                </div>
            </div>
          </section>
          
          <section class="card" id="comparisonResultCard" style="display: none;">
            <div class="card-header-flex">
              <h2 class="card-header-title">üè¶ ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡∏∏‡∏Å‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡∏ô</h2>
              <button class="btn btn-danger btn-admin" onclick="showActionButtons()"> &lt; ‡∏Å‡∏•‡∏±‡∏ö </button>
            </div>
            <div class="card-content">
                <div id="bankComparison" class="bank-comparison"></div>
                <div id="rateUpdateTime" style="text-align:center;color:#666;margin-top:6px;font-size:12px;"></div>
            </div>
          </section>

          <section class="card" id="amortizationResultCard" style="display: none;">
            <div class="card-header-flex">
              <h2 class="card-header-title">üìã ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞ (12 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÅ‡∏£‡∏Å)</h2>
              <button class="btn btn-danger btn-admin" onclick="showActionButtons()"> &lt; ‡∏Å‡∏•‡∏±‡∏ö </button>
            </div>
            <div class="card-content" style="overflow-x:auto">
                <table class="amortization">
                    <thead><tr><th>‡∏á‡∏ß‡∏î</th><th>‡∏¢‡∏≠‡∏î‡∏ú‡πà‡∏≠‡∏ô</th><th>‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô</th><th>‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢</th><th>‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πâ‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th></tr></thead>
                    <tbody id="amortizationTable"></tbody>
                </table>
            </div>
          </section>

          <section class="card" id="bankAdmin" style="display:none"></section>
          <section class="card" id="promoAdmin" style="display:none"></section>
        </div>
      </div>
    </main>

    <div id="toastContainer"></div>
    <div id="globalSpinner"><div class="spinner"></div><div class="spinner-label">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô...</div></div>
    <div id="modalHost"></div>
    <div id="compareBar"></div>
  </div>

  <script defer src="script.js"></script>
</body>
</html>